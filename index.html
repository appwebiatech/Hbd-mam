<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Selamat Ulang Tahun Ibu Tercinta</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Parisienne&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* --- 1. SETTING UTAMA & VARIABEL --- */
        :root {
            --primary: #e84393; 
            --secondary: #fd79a8; 
            --gold: #d4af37;      
            --bg-warm: #fff5f7;   
            --glass: rgba(255, 255, 255, 0.85);
            --shadow-soft: 0 10px 30px rgba(232, 67, 147, 0.15);
            --shadow-gold: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }

        /* Mencegah seleksi teks (Anti-Copy) */
        body {
            font-family: 'Quicksand', sans-serif;
            background: radial-gradient(circle at top left, var(--bg-warm), #fdfbfb);
            color: #555;
            overflow-x: hidden;
            position: relative;
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
        }

        /* PENGECUALIAN: Input form harus bisa diketik */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* --- BACKGROUND PARTIKEL --- */
        .falling-particles {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none; overflow: hidden;
        }
        .particle {
            position: absolute; border-radius: 50%; opacity: 0.5;
            animation: fall linear infinite;
        }
        .p-gold { background: var(--gold); width: 8px; height: 8px; box-shadow: 0 0 5px var(--gold); }
        .p-petal { background: var(--secondary); width: 15px; height: 15px; border-radius: 15px 0; }

        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, .script-font { font-family: 'Great Vibes', cursive; font-weight: normal; }
        .section-title {
            text-align: center; font-size: 3rem; color: var(--primary);
            margin: 60px 0 30px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

        /* --- HERO SECTION --- */
        .hero {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            perspective: 1000px; padding: 20px;
        }
        .hero-content {
            text-align: center; background: var(--glass); padding: 50px 30px;
            border-radius: 40px; /* Lebih simpel agar aman di mobile */
            backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.6);
            box-shadow: var(--shadow-soft);
            max-width: 90%;
            transform-style: preserve-3d; transition: transform 0.1s ease-out;
        }
        .hero h1 { 
            font-size: 4.5rem; 
            background: linear-gradient(to right, var(--primary), var(--gold)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            line-height: 1.1; margin: 10px 0;
        }
        .hero p { font-size: 1.2rem; margin-top: 10px; color: #777; }
        .sub-text { font-family: 'Parisienne', cursive; font-size: 1.8rem; color: var(--gold); display: block;}

        /* --- KARTU 3D --- */
        .card-section { perspective: 1500px; display: flex; justify-content: center; margin: 40px 0; }
        .birthday-card {
            width: 320px; height: 450px; position: relative;
            transform-style: preserve-3d; transition: transform 1s; cursor: pointer;
        }
        .birthday-card.opened { transform: rotateY(-160deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 15px; overflow: hidden; box-shadow: var(--shadow-gold);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border: 3px solid var(--gold); background: white;
        }
        .card-front { background: linear-gradient(135deg, #fff0f6 0%, #fff 100%); z-index: 2; }
        .card-front h2 { font-size: 3rem; color: var(--primary); margin-top: 20px;}
        .card-front img { width: 70%; margin-bottom: 20px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1));}
        .click-hint { position: absolute; bottom: 20px; font-size: 0.9rem; color: var(--gold); animation: pulse 1.5s infinite; }
        
        .card-inside {
            transform: rotateY(180deg); z-index: 1; background: #fffaf0; padding: 25px; text-align: center;
            /* Pola background */
            background-image: radial-gradient(#d4af37 1px, transparent 1px); background-size: 20px 20px;
        }
        .card-inside h3 { font-family: 'Parisienne', cursive; font-size: 2rem; color: var(--primary); margin-bottom: 15px; }
        .card-inside p { font-size: 1rem; line-height: 1.6; color: #666; font-style: italic;}

        @keyframes pulse { 0%, 100% { opacity: 0.6; transform: scale(1); } 50% { opacity: 1; transform: scale(1.1); } }

        /* --- GALERI POLAROID --- */
        .gallery-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
        .polaroid {
            background: white; padding: 10px 10px 45px 10px; box-shadow: var(--shadow-soft);
            transform: rotate(var(--r)); transition: 0.4s ease-in-out; position: relative; z-index: 1;
            width: 200px; /* Ukuran fix agar rapi */
        }
        .polaroid:hover { transform: scale(1.1) rotate(0deg) !important; z-index: 10; box-shadow: var(--shadow-gold); }
        .polaroid img { width: 100%; height: 200px; object-fit: cover; filter: sepia(10%); border-radius: 2px;}
        .polaroid::after { 
            content: attr(data-caption); position: absolute; bottom: 10px; width: 100%; 
            text-align: center; left: 0; font-family: 'Great Vibes', cursive; font-size: 1.3rem; color: #555; 
        }

        /* --- FORM & WISHES --- */
        .wishes-layout { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start; margin-bottom: 50px;
        }

        .form-card { background: white; padding: 30px; border-radius: 20px; box-shadow: var(--shadow-gold); border: 2px solid var(--gold); }
        .input-field { 
            width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #eee; 
            border-radius: 10px; font-family: inherit; transition: 0.3s; background: #fffaf0; font-size: 1rem;
        }
        .input-field:focus { border-color: var(--primary); outline: none; background: white; }
        
        .btn-submit {
            width: 100%; padding: 12px; background: linear-gradient(to right, var(--primary), var(--gold));
            border: none; border-radius: 50px; color: white; font-weight: bold; font-size: 1rem;
            cursor: pointer; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); transition: 0.3s;
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(212, 175, 55, 0.6); }

        /* Papan Ucapan */
        .board-container {
            background: white; border-radius: 20px; padding: 25px;
            box-shadow: var(--shadow-soft); position: relative;
            border: 1px dashed var(--gold);
            background-image: radial-gradient(#e84393 0.5px, transparent 0.5px), radial-gradient(#e84393 0.5px, #ffffff 0.5px);
            background-size: 20px 20px; background-position: 0 0, 10px 10px;
        }
        .wishes-list { max-height: 500px; overflow-y: auto; padding-right: 5px; }
        .wishes-list::-webkit-scrollbar { width: 6px; }
        .wishes-list::-webkit-scrollbar-thumb { background: var(--secondary); border-radius: 10px; }

        .wish-note {
            background: #fff; padding: 15px; margin-bottom: 15px; position: relative;
            border-radius: 2px; box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
            font-family: 'Great Vibes', cursive; font-size: 1.3rem; line-height: 1.4; color: #333;
        }
        .wish-note::before { /* Efek Solasi */
            content: ''; position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 20px; background: rgba(255, 215, 0, 0.4); 
            border-left: 2px dotted rgba(0,0,0,0.1); border-right: 2px dotted rgba(0,0,0,0.1);
        }
        .note-sender { font-family: 'Quicksand', sans-serif; font-weight: bold; font-size: 0.8rem; color: var(--primary); text-align: right; display: block; margin-top: 8px;}

        /* --- BUTTONS --- */
        .btn-download {
            display: block; width: 100%; margin-top: 15px; padding: 12px;
            background: white; border: 2px solid var(--gold); color: var(--gold);
            border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s;
            text-align: center; font-size: 0.95rem;
        }
        .btn-download:hover { background: var(--gold); color: white; }

        .music-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 1000;
            width: 50px; height: 50px; border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--gold));
            border: 2px solid white; color: white; font-size: 18px;
            cursor: pointer; box-shadow: var(--shadow-gold);
            display: flex; justify-content: center; align-items: center;
        }
        .music-btn.playing i { animation: spin 4s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        footer { text-align: center; padding: 40px 20px; color: var(--primary); font-size: 0.8rem; }

        /* --- RESPONSIVE CSS (MOBILE) --- */
        @media (max-width: 768px) {
            .hero h1 { font-size: 3.5rem; }
            .section-title { font-size: 2.5rem; margin: 40px 0 20px; }
            
            .wishes-layout { grid-template-columns: 1fr; } /* Stack ke bawah */
            
            .birthday-card { width: 90%; height: 400px; }
            .card-inside h3 { font-size: 1.8rem; }
            
            .polaroid { width: 45%; padding-bottom: 35px; } /* Polaroid jadi 2 kolom */
            .polaroid img { height: 150px; }
            .polaroid::after { font-size: 1rem; }
            
            .container { padding: 15px; }
            .hero-content { padding: 30px 20px; border-radius: 20px; }
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="falling-particles" id="particles"></div>

    <audio id="bgMusic" loop>
        <source src="Hbd.mp3" type="audio/mpeg">
    </audio>
    <div class="music-btn" onclick="toggleMusic()">
        <i class="fas fa-music"></i>
    </div>

    <section class="hero">
        <div class="hero-content" id="heroTilt">
            <span class="sub-text">Special Day for a Special Lady</span>
            <h1>Selamat Ulang Tahun, Ibu</h1>
            <p>Cintamu adalah cahaya yang tak pernah padam dalam hidupku.</p>
            <div style="font-size: 2.5rem; margin-top: 15px;">üíñüå∏üéÇ</div>
        </div>
    </section>

    <div class="container">
        
        <h2 class="section-title script-font">Kartu Ucapan Spesial</h2>
        <div class="card-section">
            <div class="birthday-card" onclick="this.classList.toggle('opened')">
                <div class="card-face card-front">
                    <img src="https://cdn-icons-png.flaticon.com/512/4525/4525679.png" alt="Bunga">
                    <h2 class="script-font">Untuk Ibu</h2>
                    <p class="click-hint"><i class="fas fa-hand-pointer"></i> Ketuk untuk membuka</p>
                </div>
                <div class="card-face card-inside">
                    <h3>Ibu Tersayang,</h3>
                    <p>"Di hari bahagiamu ini, aku hanya ingin mengucapkan terima kasih. Terima kasih telah menjadi rumah tempatku pulang. Semoga kesehatan dan kebahagiaan selalu memelukmu bu."</p>
                    <p style="margin-top:20px; font-weight:bold; font-size:0.9rem;">‚Äî Anakmu Tercinta ‚ù§ ‚Äî </p>
                </div>
            </div>
        </div>


        <h2 class="section-title script-font">Momen Berharga</h2>
        <div class="gallery-grid">
            <div class="polaroid" style="--r:-3deg;" data-caption="Senyuman Hangat">
                <img src="Img1.jpg" onerror="this.src='https://images.unsplash.com/photo-1490750967868-58cb75063ed4?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80'" alt="Foto 1">
            </div>
            <div class="polaroid" style="--r:2deg;" data-caption="Liburan Keluarga">
                <img src="Img2.jpg" onerror="this.src='https://images.unsplash.com/photo-1513151233558-d860c5398176?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80'" alt="Foto 2">
            </div>
            <div class="polaroid" style="--r:-1deg;" data-caption="Cinta Kasih">
                <img src="Img3.jpg" onerror="this.src='https://images.unsplash.com/photo-1502086223501-7ea6ecd79368?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80'" alt="Foto 3">
            </div>
        </div>


        <h2 class="section-title script-font">Papan Doa & Harapan</h2>
        <div class="wishes-layout">
            
            <div class="form-card">
                <h3 style="text-align:center; color:var(--primary); margin-bottom:15px; font-family:'Great Vibes'; font-size:2rem;">Kirim Ucapan</h3>
                <form id="wishForm">
                    <input type="text" id="namaInput" class="input-field" placeholder="Nama Pengirim" required autocomplete="off">
                    <textarea id="pesanInput" class="input-field" rows="4" placeholder="Tulis doa termanis di sini..." required></textarea>
                    <button type="submit" class="btn-submit">Tempel di Papan ‚ú®</button>
                </form>
            </div>

            <div>
                <div class="board-container" id="captureArea">
                    <h3 style="text-align:center; font-family:'Great Vibes'; color:var(--gold); font-size:2rem; margin-bottom:15px;">~ Kenangan Ucapan ~</h3>
                    <div class="wishes-list" id="wishesList">
                        <p style="text-align:center; opacity:0.6; font-size:0.9rem;">Memuat doa-doa...</p>
                    </div>
                </div>
                
                <button class="btn-download" onclick="downloadWishes()">
                    <i class="fas fa-camera"></i> Simpan Papan Ucapan
                </button>
                <p style="text-align:center; font-size:0.75rem; color:#999; margin-top:5px;">Klik untuk mengunduh kenangan ini.</p>
            </div>

        </div>
    </div>

    <footer>
        <p>Made By: AppWebiatecth | Studioofficialridho - All Right Reserved</p>
    </footer>


    <script type="module">
        // --- KONFIGURASI FIREBASE (JANGAN DIHAPUS) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyB_SVSRikno8wtrnp06p_2ENTA4dsis6Dg",
          authDomain: "ucapan-ulang-tahun-d5b7f.firebaseapp.com",
          projectId: "ucapan-ulang-tahun-d5b7f",
          storageBucket: "ucapan-ulang-tahun-d5b7f.firebasestorage.app",
          messagingSenderId: "802099201654",
          appId: "1:802099201654:web:493571c6402e2daee28157",
          measurementId: "G-W7S6KP1GVT"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tableName = "ucapan_ultah_ibu_v2"; 

        // --- LOGIC KIRIM PESAN ---
        const form = document.getElementById('wishForm');
        const btnSubmit = document.querySelector('.btn-submit');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';
            btnSubmit.disabled = true;

            try {
                await addDoc(collection(db, tableName), {
                    nama: document.getElementById('namaInput').value,
                    pesan: document.getElementById('pesanInput').value,
                    waktu: serverTimestamp()
                });
                document.getElementById('pesanInput').value = ""; // Reset pesan saja, nama biarin
                // alert("Berhasil!"); 
            } catch (err) {
                alert("Gagal mengirim. Cek koneksi internet.");
                console.error(err);
            } finally {
                btnSubmit.innerHTML = 'Tempel di Papan ‚ú®';
                btnSubmit.disabled = false;
            }
        });

        // --- LOGIC BACA PESAN REALTIME ---
        const q = query(collection(db, tableName), orderBy("waktu", "desc"));
        const listContainer = document.getElementById('wishesList');

        onSnapshot(q, (snapshot) => {
            listContainer.innerHTML = "";
            if (snapshot.empty) {
                listContainer.innerHTML = "<p style='text-align:center; padding:20px;'>Belum ada ucapan. Jadilah yang pertama!</p>";
                return;
            }
            
            snapshot.forEach(doc => {
                const data = doc.data();
                const note = document.createElement('div');
                note.className = 'wish-note';
                note.innerHTML = `
                    "${sanitize(data.pesan)}"
                    <span class="note-sender">- ${sanitize(data.nama)}</span>
                `;
                listContainer.appendChild(note);
            });
        });

        function sanitize(str) {
            if(!str) return "";
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }
    </script>

    <script>
        // --- 1. SCRIPT PELINDUNG (ANTI-STEAL) ---
        // Mematikan F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
        document.onkeydown = function(e) {
            if (e.keyCode == 123) { // F12
                return false;
            }
            if (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0))) {
                return false;
            }
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) { // View Source
                return false;
            }
        };

        // --- 2. PARTIKEL LATAR BELAKANG ---
        const particlesContainer = document.getElementById('particles');
        const particleCount = window.innerWidth < 768 ? 15 : 30; // Kurangi partikel di HP biar ringan
        
        for(let i=0; i<particleCount; i++){
            let p = document.createElement('div');
            p.className = Math.random() > 0.5 ? 'particle p-gold' : 'particle p-petal';
            p.style.left = Math.random() * 100 + 'vw';
            p.style.animationDuration = (Math.random() * 5 + 5) + 's';
            p.style.animationDelay = (Math.random() * 5) + 's';
            particlesContainer.appendChild(p);
        }

        // --- 3. EFEK 3D HERO (Hanya aktif di Desktop) ---
        if(window.innerWidth > 768) {
            const hero = document.getElementById('heroTilt');
            document.addEventListener('mousemove', (e) => {
                const x = (window.innerWidth / 2 - e.pageX) / 60;
                const y = (window.innerHeight / 2 - e.pageY) / 60;
                hero.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
            });
        }

        // --- 4. MUSIK PLAYER ---
        const audio = document.getElementById('bgMusic');
        const musicBtn = document.querySelector('.music-btn');
        let isPlaying = false;
        
        function toggleMusic() {
            if(!isPlaying) { 
                audio.play().catch(e => alert("Silakan interaksi dengan layar dulu agar musik bisa diputar."));
                musicBtn.classList.add('playing'); 
                musicBtn.innerHTML = '<i class="fas fa-pause"></i>'; 
            } else { 
                audio.pause(); 
                musicBtn.classList.remove('playing'); 
                musicBtn.innerHTML = '<i class="fas fa-music"></i>'; 
            }
            isPlaying = !isPlaying;
        }

        // --- 5. LOGIC DOWNLOAD GAMBAR (Fix Scroll Issue) ---
        function downloadWishes() {
            const captureArea = document.getElementById('captureArea');
            const wishesList = document.getElementById('wishesList');
            const btn = document.querySelector('.btn-download');
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            
            // Simpan style asli
            const originalMaxHeight = wishesList.style.maxHeight;
            const originalOverflow = wishesList.style.overflow;

            // Buka scroll agar semua konten terlihat oleh kamera html2canvas
            wishesList.style.maxHeight = "none";
            wishesList.style.overflow = "visible";

            html2canvas(captureArea, {
                scale: 2, 
                backgroundColor: '#fff', 
                useCORS: true 
            }).then(canvas => {
                // Kembalikan style scroll
                wishesList.style.maxHeight = originalMaxHeight;
                wishesList.style.overflow = originalOverflow;

                const link = document.createElement('a');
                link.download = 'Kenangan-Ucapan-Ibu.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                btn.innerHTML = '<i class="fas fa-check"></i> Tersimpan!';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-camera"></i> Simpan Papan Ucapan';
                }, 3000);
            }).catch(err => {
                console.error(err);
                btn.innerHTML = '<i class="fas fa-times"></i> Gagal';
                // Kembalikan style jika error
                wishesList.style.maxHeight = originalMaxHeight;
                wishesList.style.overflow = originalOverflow;
            });
        }
    </script>
</body>
                            </html>
